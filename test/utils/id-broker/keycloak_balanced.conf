# This config forces the use of the infinityspan cache
# The auth code will be requested on kc2,
# while it will be redeemed for an access token on kc1

SSLEngine on
SSLProxyEngine on
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off
SSLProxyCheckPeerExpire off

SSLCertificateFile /etc/univention/ssl/kc.DOMAIN/cert.pem
SSLCertificateKeyFile /etc/univention/ssl/kc.DOMAIN/private.key
SSLCACertificateFile /etc/univention/ssl/ucsCA/CAcert.pem

ProxyPreserveHost Off

<Location "/">
	ProxyPass "https://login.kc1.DOMAIN/" retry=0
	Header set kc_info "kc1"
</Location>
<Location "/auth/realms/ID-Broker/protocol/openid-connect/auth">
	# path to request an auth code
	ProxyPass "https://login.kc2.DOMAIN/auth/realms/ID-Broker/protocol/openid-connect/auth" retry=0
	Header set kc_info "kc2"
</Location>
<Location "/auth/realms/ID-Broker/broker/traeger1/endpoint">
	# token endpoint
	ProxyPass "https://login.kc1.DOMAIN/auth/realms/ID-Broker/broker/traeger1/endpoint" retry=0
	Header set kc_info "kc1"
</Location>
